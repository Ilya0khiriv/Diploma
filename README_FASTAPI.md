## Обзор
Этот проект представляет собой веб-приложение, построенное с использованием FastAPI, которое предоставляет систему аутентификации пользователей, позволяет пользователям взаимодействовать с ИИ и хранить историю разговоров в базе данных. Пользователи могут зарегистрироваться, войти в систему, задавать вопросы и просматривать предыдущие разговоры с ИИ. Приложение также позволяет пользователям настраивать количество сообщений, отображаемых из их истории общения.

### Основные функции
- **Аутентификация пользователя**:
  - Регистрация и вход пользователей с использованием обработки формы FastAPI.
  - Аутентификация на основе токенов через cookies (`access_token`).
  - Функция выхода, которая очищает сессию.

- **Взаимодействие с ИИ**:
  - Пользователи могут отправлять вопросы в систему ИИ и получать ответы.
  - Разговоры сохраняются и могут быть извлечены по идентификатору пользователя.
  - Пользователи могут контролировать, сколько предыдущих сообщений отображать в своей истории общения.

- **Интерфейс**:
  - HTML-шаблоны для регистрации пользователя, входа в систему и защищенной страницы для взаимодействия с ИИ.
  - Сообщения об ошибках и разговоры отображаются на защищенной странице.
  - Статические файлы (CSS) используются для стилизации страниц.

---

## Описание файлов

### `main.py`
Основной файл приложения, который:
- Управляет регистрацией, входом и выходом пользователей.
- Аутентифицирует пользователей через JWT токены и управляет сессиями.
- Взаимодействует с системой ИИ через пользовательскую функцию, которая вызывает внешний сервис.
- Управляет разговорами и сохраняет данные пользователя.

**Основные компоненты**:
- **Формы**:
  - `register`: Принимает `username` и `password` для создания нового пользователя. 
  - `login`: Принимает `username` и `password` для аутентификации пользователя.
  - `handle_form`: Обрабатывает взаимодействие пользователя с ИИ (отправка вопросов и настройка сообщений).

- **Помощники**:
  - `hash_password`: Хеширует пароль пользователя перед сохранением.
  - `verify_password`: Проверяет введенный пароль с сохраненным хешем.
  - `create_access_token`: Генерирует JWT токен для аутентификации пользователя.
  - `verify_access_token`: Проверяет действительность предоставленного JWT токена.
  - `get_response`: Отправляет запрос внешнему сервису ИИ и возвращает ответ.
  - `update_amount`: Обновляет количество сообщений, которое пользователь хочет видеть в истории общения.

- **Шаблоны**:
  - `register.html`: Страница регистрации пользователя.
  - `login.html`: Страница входа пользователя.
  - `protected.html`: Главная страница, где пользователи взаимодействуют с ИИ.

---

### Маршруты

- **`/register`**: Отображает форму регистрации для новых пользователей.
  ![Регистрация](https://post-images.org/download/194.113.153.253-desk/zVyeMT1Q1733997362.png)
- **`/login`**: Отображает форму входа для существующих пользователей.
  ![LOGIN](https://post-images.org/download/194.113.153.253-desk/VHUIdt7h1733997452.png)
- **`/`**: Главная защищенная страница, на которой пользователи могут задавать вопросы ИИ и просматривать предыдущие разговоры.
![PROTECTED](https://post-images.org/download/194.113.153.253-desk/LzmeQXp01733997759.png)
- **`/logout`**: Выходит из системы, удаляя cookie с токеном аутентификации и перенаправляя на страницу входа.

---

### Вспомогательные функции
- **`register_page`**: Отображает форму регистрации.
- **`register`**: Обрабатывает регистрацию пользователя и сохраняет его в базе данных.
- **`login_page`**: Отображает форму входа.
- **`login`**: Аутентифицирует пользователя, создает JWT токен и устанавливает cookie для сессии.
- **`handle_form`**: Обрабатывает взаимодействие с ИИ, показывает предыдущий разговор и обрабатывает новые вопросы и настройки сообщений.
- **`logout`**: Выходит из системы и удаляет cookie аутентификации.
- **`get_response`**: Отправляет вопрос внешнему сервису ИИ и получает ответ.

---

## Статические файлы и шаблоны
- Статические файлы (CSS) обслуживаются из директории `static` и используются для стилизации шаблонов.
- Шаблоны хранятся в директории `templates`.

---

## Использование

1. Установите зависимости

2. Запустите приложение
   - Приложение будет доступно по адресу `http://0.0.0.0:9000`.

3. Откройте браузер:
   - Перейдите на `./register`, чтобы создать новую учетную запись.
   - Войдите в систему на `./login`.

4. После входа перейдите на главную страницу (`/`), чтобы:
   - Задавать вопросы ИИ.
   - Настроить количество отображаемых предыдущих сообщений.

5. Чтобы выйти из системы, перейдите на маршрут `/logout`.
